<div ng-controller="FormResultsController as vm">
    <div class="row">
        <section class="cell">
            <div>
                <h1>
                    <a href="#/"><i18n>formulaire.title</i18n></a>
                    <i18n>formulaire.title.separator</i18n>[[form.title]]
                    <i18n>formulaire.title.separator</i18n><i18n>formulaire.results</i18n>
                </h1>
            </div>
        </section>

        <section class="cell" style="float:right;">
            <div class="main-button">
                <button class="cell" ng-click="vm.exportForm()"><i18n>formulaire.form.download.all.results</i18n></button>
            </div>
        </section>
    </div>

    <div class="results-form">
        <div class="result">
            <!-- Question title -->
            <div class="title">
                <h4 ng-if="vm.question.question_type == vm.types.FREETEXT">[[vm.question.title]]</h4>
                <h4 ng-if="vm.question.question_type != vm.types.FREETEXT && vm.nbResults > 1">
                    [[vm.question.title]] ([[vm.nbResults]] <i18n>formulaire.responses</i18n>)</h4>
                <h4 ng-if="vm.question.question_type != vm.types.FREETEXT && vm.nbResults <= 1">
                    [[vm.question.title]] ([[vm.nbResults]] <i18n>formulaire.response</i18n>)</h4>
                <button class="cell" ng-click="vm.zipAndDownload()" ng-if="vm.question.question_type == vm.types.FILE">
                    <i18n>formulaire.form.download.all.files</i18n>
                </button>
            </div>
            <!-- List of results -->
            <div ng-if="vm.question.question_type == vm.types.FREETEXT" class="freetext" bind-html="vm.question.statement"></div>
            <div ng-if="vm.question.question_type == vm.types.SINGLEANSWER || vm.question.question_type == vm.types.MULTIPLEANSWER"
                 class="choices">
                <div class="twelve-mobile" ng-class="vm.question.question_type == vm.types.MULTIPLEANSWER ? 'twelve' : 'four'">
                    <div ng-repeat="choice in vm.question.choices.all | limitTo:vm.nbLinesDisplay" class="choice">
                        <div class="infos twelve-mobile" ng-class="vm.question.question_type == vm.types.MULTIPLEANSWER ? 'four' : 'twelve'">
                            <div class="choice-value eight twelve-mobile ellipsis">
                                <span ng-if="!$last">[[$index + 1]]. </span>[[choice.value]]
                            </div>
                            <div class="four twelve-mobile ellipsis bold">
                                [[choice.nbResponses]]
                                <i18n ng-if="choice.nbResponses > 1">formulaire.responses</i18n>
                                <i18n ng-if="choice.nbResponses <= 1">formulaire.response</i18n>
                                ([[(choice.nbResponses / vm.nbResults * 100).toFixed(2)]]%)
                            </div>
                        </div>
                        <div ng-if="vm.question.question_type == vm.types.MULTIPLEANSWER" class="eight zero-mobile">
                            <div class="graph-bar"
                                 ng-style="{width: (95 * choice.nbResponses / vm.nbResults + '%'), 'background-color': vm.getColor(choice.id)}">
                            </div>
                        </div>
                    </div>
                </div>

                <div ng-if="vm.question.question_type == vm.types.SINGLEANSWER" class="eight zero-mobile">
                    <div id="singleanswer-response-chart"></div>
                </div>
            </div>
            <div ng-if="vm.question.question_type != vm.types.SINGLEANSWER &&
                        vm.question.question_type != vm.types.MULTIPLEANSWER &&
                        vm.question.question_type != vm.types.FREETEXT">
                <div ng-repeat="distrib in vm.distributions.all | orderBy:'date_response':true | limitTo:vm.nbLinesDisplay" class="distrib">
                    <div class="infos four twelve-mobile">
                        <div class="eight twelve-mobile">[[displayDate(distrib.date_response)]]</div>
                        <div class="four twelve-mobile ellipsis" ng-if="!vm.form.anonymous">[[distrib.responder_name]]</div>
                    </div>
                    <div class="eight twelve-mobile results">
                        <div ng-repeat="result in vm.getDataByDistrib(distrib.id) | limitTo:vm.nbLinesDisplay"
                             ng-class="{'notLast' : !$last}">
                            <div ng-if="vm.question.question_type == vm.types.SHORTANSWER ||
                                        vm.question.question_type == vm.types.LONGANSWER ||
                                        vm.question.question_type == vm.types.DATE ||
                                        vm.question.question_type == vm.types.TIME"
                                 bind-html="result.answer"></div>
                            <a ng-if="vm.question.question_type == vm.types.FILE"
                               ng-click="vm.downloadFile(result.id)">
                                <i class="download lg-icon spaced-right"></i> [[result.filename]]
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- See more button -->
            <div ng-if="vm.nbLines >= vm.nbLinesDisplay" style="margin: 1%;">
                <a ng-click="vm.nbLinesDisplay = vm.nbLinesDisplay + 10">
                    <i18n>formulaire.seeMore</i18n>
                </a>
            </div>
        </div>


        <!-- Navigation buttons -->
        <div class="buttons">
            <button class="cell" ng-click="vm.prev()" ng-disabled="vm.question.position == 1">
                <i18n class="zero-mobile">formulaire.prev</i18n>
                <i class="chevron-left zero-desktop"></i>
            </button>
            <div class="goto six">
                <i18n class="one" style="margin-right:10px">formulaire.goTo</i18n>
                <select class="ten" ng-change="vm.goTo(vm.navigatorValue)" ng-model="vm.navigatorValue" style="height: 24px;">
                    <option ng-repeat="question in vm.questions.all" ng-value="question.position"
                            ng-selected="vm.navigatorValue == question.position">
                        [[question.position]]. [[question.title]]
                    </option>
                </select>
            </div>
            <button class="cell" ng-click="vm.next()" ng-disabled="vm.last">
                <i18n class="zero-mobile">formulaire.next</i18n>
                <i class="chevron-right zero-desktop"></i>
            </button>
        </div>
    </div>

    <container template='lightbox'></container>
</div>