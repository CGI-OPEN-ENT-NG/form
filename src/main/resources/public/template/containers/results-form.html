<div ng-controller="FormResultsController as vm">
    <div class="row">
        <section class="cell">
            <div>
                <h1>
                    <a href="#/"><i18n>formulaire.title</i18n></a>
                    <i18n>formulaire.title.separator</i18n>[[form.title]]
                    <i18n>formulaire.title.separator</i18n><i18n>formulaire.results</i18n>
                </h1>
            </div>
        </section>

        <section class="cell" style="float:right;">
            <div class="main-button">
                <button class="cell" ng-click="vm.exportForm()"><i18n>formulaire.form.download.all.results</i18n></button>
            </div>
        </section>
    </div>

    <div class="results-form">
        <div class="result">
            <!-- Question title -->
            <div class="title">
                <h4>
                    [[vm.question.title]] ([[vm.nbResults]]
                    <i18n ng-if="vm.nbResults > 1">formulaire.responses</i18n>
                    <i18n ng-if="vm.nbResults <= 1">formulaire.response</i18n>)
                </h4>
                <button class="cell" ng-click="vm.zipAndDownload()" ng-if="vm.question.question_type == vm.types.FILE">
                    <i18n>formulaire.form.download.all.files</i18n>
                </button>
            </div>
            <!-- List of results -->
            <div ng-repeat="distrib in vm.distributions.all | orderBy:'date_response' | limitTo:vm.nbResultsDisplay">
                <div class="distrib">
                    <div class="two twelve-mobile">[[distrib.date_response.toLocaleString()]]</div>
                    <div class="two twelve-mobile ellipsis" ng-if="!vm.form.anonymous">[[distrib.responder_name]]</div>
                    <div class="eight twelve-mobile ellipsis results">
                        <div ng-repeat="result in vm.getDataByDistrib(distrib.id) | limitTo:vm.nbResultsDisplay"
                             ng-class="{'notLast' : !$last}">
                            <div ng-if="vm.question.question_type == vm.types.SHORTANSWER ||
                                vm.question.question_type == vm.types.LONGANSWER ||
                                vm.question.question_type == vm.types.DATE ||
                                vm.question.question_type == vm.types.TIME"
                                bind-html="result.answer"></div>
                            <a ng-if="vm.question.question_type == vm.types.FILE"
                               ng-click="vm.downloadFile(result.response_id)">
                                <i class="download lg-icon spaced-right"></i> [[result.filename]]
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Navigation buttons -->
            <div ng-if="vm.nbResults >= vm.nbResultsDisplay" style="margin: 1%;">
                <a ng-click="vm.nbResultsDisplay = vm.nbResultsDisplay + 10" ng-if="vm.question.question_type == vm.types.FILE">
                    <i18n>formulaire.seeMore</i18n>
                </a>
            </div>
        </div>
        <div class="buttons">
            <button class="cell" ng-click="vm.prev()" ng-disabled="vm.question.position == 1">
                <i18n class="zero-mobile">formulaire.prev</i18n>
                <i class="chevron-left zero-desktop"></i>
            </button>
            <div class="goto six">
                <i18n class="one" style="margin-right:10px">formulaire.goTo</i18n>
                <select class="ten" ng-change="vm.goTo(vm.navigatorValue)" ng-model="vm.navigatorValue" style="height: 24px;">
                    <option ng-repeat="question in vm.questions.all" ng-value="question.position"
                            ng-selected="vm.navigatorValue == question.position">
                        [[question.position]]. [[question.title]]
                    </option>
                </select>
            </div>
            <button class="cell" ng-click="vm.next()" ng-disabled="vm.last">
                <i18n class="zero-mobile">formulaire.next</i18n>
                <i class="chevron-right zero-desktop"></i>
            </button>
        </div>
    </div>

    <container template='lightbox'></container>
</div>